<!-- Navbar -->
<nav class="navbar navbar-expand navbar-dark bg-dark fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand" routerLink="/dashboard">SB Admin</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" routerLink="/dashboard">Retour au Dashboard</a>
        </li>
       <li class="nav-item">
          <a class="nav-link" (click)="logout()">Déconnexion </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="container mt-5">
  <!-- System Status -->
  <div *ngIf="systemStatus" class="alert alert-info mb-4">Statut système : {{ systemStatus }}</div>

  <!-- Page Header -->
  <h2 class="mb-4">Gestion des Clients</h2>

  <!-- Client Form -->
  <div class="card shadow mb-4">
    <div class="card-header bg-primary text-white">
      <h5>{{ isEditing ? 'Modifier un client' : 'Ajouter un client' }}</h5>
    </div>
    <div class="card-body">
      <form #clientForm="ngForm" (ngSubmit)="createOrUpdateClient()">
        <div class="row">
          <div class="col-md-6 form-group">
            <label for="name">Nom</label>
            <input type="text" class="form-control" id="name" name="name" [(ngModel)]="selectedClient.name" required>
            <div *ngIf="formErrors['name']" class="text-danger small">{{ formErrors['name'] }}</div>
          </div>
          <div class="col-md-6 form-group">
            <label for="companyName">Nom de l'entreprise</label>
            <input type="text" class="form-control" id="companyName" name="companyName" [(ngModel)]="selectedClient.companyName" required>
            <div *ngIf="formErrors['companyName']" class="text-danger small">{{ formErrors['companyName'] }}</div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 form-group">
            <label for="address">Adresse</label>
            <input type="text" class="form-control" id="address" name="address" [(ngModel)]="selectedClient.address" required>
            <div *ngIf="formErrors['address']" class="text-danger small">{{ formErrors['address'] }}</div>
          </div>
          <div class="col-md-6 form-group">
            <label for="contactEmail">Email de contact</label>
            <input type="email" class="form-control" id="contactEmail" name="contactEmail" [(ngModel)]="selectedClient.contactEmail" required>
            <div *ngIf="formErrors['contactEmail']" class="text-danger small">{{ formErrors['contactEmail'] }}</div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 form-group">
            <label for="contactPhone">Téléphone de contact</label>
            <input type="text" class="form-control" id="contactPhone" name="contactPhone" [(ngModel)]="selectedClient.contactPhone">
            <div *ngIf="formErrors['contactPhone']" class="text-danger small">{{ formErrors['contactPhone'] }}</div>
          </div>
        </div>
        <div class="mt-3">
          <button type="submit" class="btn btn-primary" [disabled]="!clientForm.valid">{{ isEditing ? 'Mettre à jour' : 'Ajouter' }}</button>
          <button type="button" class="btn btn-secondary ms-2" (click)="resetForm()">Annuler</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Client List -->
  <div class="card shadow">
    <div class="card-header bg-primary text-white">
      <h5>Liste des Clients</h5>
    </div>
    <div class="card-body">
      <!-- Search and Filters -->
      <div class="filter-section mb-4">
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="searchQuery">Rechercher :</label>
              <input type="text" class="form-control" id="searchQuery" [(ngModel)]="searchQuery" (input)="searchClients()" placeholder="Rechercher par nom, email ou téléphone">
            </div>
          </div>
          <div class="col-md-6 d-flex align-items-end">
            <div class="sort-buttons">
              <button class="btn btn-outline-primary me-2" (click)="sortClients('asc')">Trier A-Z</button>
              <button class="btn btn-outline-primary me-2" (click)="sortClients('desc')">Trier Z-A</button>
              <button class="btn btn-outline-secondary me-2" (click)="resetFilters()">Réinitialiser</button>
              <button class="btn btn-success" (click)="exportPDF()">Exporter en PDF</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Client Table -->
      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Nom</th>
              <th>Nom de l'entreprise</th>
              <th>Adresse</th>
              <th>Email</th>
              <th>Téléphone</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let client of filteredClients">
              <td>{{ client.id }}</td>
              <td>{{ client.name }}</td>
              <td>{{ client.companyName }}</td>
              <td>{{ client.address }}</td>
              <td>{{ client.contactEmail }}</td>
              <td>{{ client.contactPhone || 'N/A' }}</td>
              <td>
                <button class="btn btn-warning btn-sm me-2" (click)="selectClient(client)"><i class="bi bi-pen-fill"></i></button>
                <button class="btn btn-sm btn-danger" (click)="deleteClient(client.id!)"><i class="bi bi-trash-fill"></i></button>
              </td>
            </tr>
            <tr *ngIf="filteredClients.length === 0">
              <td colspan="7" class="text-center">Aucun client trouvé.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>